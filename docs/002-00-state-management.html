<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-12T13:30:42.184373"><title>Module 2 : L'essentiel - Strat&eacute;gies de Gestion d'&Eacute;tat (State Management) | Angular avancé</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"le-probl-me-prop-drilling-et-tat-incoh-rent","level":0,"title":"Le Problème : \"Prop Drilling\" et État Incohérent","anchor":"#le-probl-me-prop-drilling-et-tat-incoh-rent"},{"id":"solution-1-le-service-stateful-avec-rxjs-l-approche-pragmatique","level":0,"title":"Solution 1 : Le Service \"Stateful\" avec RxJS (L\u0027approche pragmatique)","anchor":"#solution-1-le-service-stateful-avec-rxjs-l-approche-pragmatique"},{"id":"exercice-2-1-cr-er-un-store-fait-main-pour-une-liste-de-t-ches","level":0,"title":"Exercice 2.1 : Créer un Store \"fait-main\" pour une liste de tâches","anchor":"#exercice-2-1-cr-er-un-store-fait-main-pour-une-liste-de-t-ches"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"},{"id":"conclusion","level":0,"title":"Conclusion","anchor":"#conclusion"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 2 : L'essentiel - Strat&eacute;gies de Gestion d'&Eacute;tat (State Management) | Angular avancé"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Angular avancé Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/002-00-state-management.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 2 : L'essentiel - Strat&eacute;gies de Gestion d'&Eacute;tat (State Management) | Angular avancé"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/002-00-state-management.html#webpage",
    "url": "writerside-documentation/002-00-state-management.html",
    "name": "Module 2 : L'essentiel - Strat&eacute;gies de Gestion d'&Eacute;tat (State Management) | Angular avancé",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Angular avancé Help"
}</script><!-- End Schema.org --></head><body data-id="002-00-state-management" data-main-title="Module 2 : L'essentiel - Stratégies de Gestion d'État (State Management)" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Angular avancé  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="002-00-state-management" id="002-00-state-management.md">Module 2 : L'essentiel - Stratégies de Gestion d'État (State Management)</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h2><p id="-v8mhia_10">&Agrave; la fin de ce module, vous serez en mesure de :</p><ul class="list _bullet" id="-v8mhia_11"><li class="list__item" id="-v8mhia_12"><p id="-v8mhia_16"><span class="control" id="-v8mhia_17">Identifier</span> les probl&egrave;mes de communication entre composants qui surviennent dans une application en croissance (&quot; prop drilling&quot; et &eacute;tat incoh&eacute;rent).</p></li><li class="list__item" id="-v8mhia_13"><p id="-v8mhia_18"><span class="control" id="-v8mhia_19">Comprendre</span> le besoin d'une source de v&eacute;rit&eacute; unique pour les donn&eacute;es de votre application.</p></li><li class="list__item" id="-v8mhia_14"><p id="-v8mhia_20"><span class="control" id="-v8mhia_21">Concevoir</span> et <span class="control" id="-v8mhia_22">impl&eacute;menter</span> un service &quot;stateful&quot; en utilisant RxJS (<code class="code" id="-v8mhia_23">BehaviorSubject</code>) comme premi&egrave;re solution de gestion d'&eacute;tat.</p></li><li class="list__item" id="-v8mhia_15"><p id="-v8mhia_24"><span class="control" id="-v8mhia_25">Distinguer</span> les avantages et les limites de cette approche &quot;fait-main&quot;.</p></li></ul></section><section class="chapter"><h2 id="introduction" data-toc="introduction">Introduction</h2><p id="-v8mhia_26">Votre application grandit. Au d&eacute;but, tout &eacute;tait simple : un composant parent parlait &agrave; son enfant direct. Mais maintenant, les familles de composants sont devenues complexes. Le composant &quot;Panier&quot; dans le header doit conna&icirc;tre le nombre d'articles, mais c'est le composant &quot;D&eacute;tailProduit&quot;, enfoui trois niveaux plus bas, qui contient le bouton &quot; Ajouter au panier&quot;. Comment faire communiquer ces deux composants &eacute;loign&eacute;s sans cr&eacute;er un plat de spaghettis de d&eacute;pendances ?</p><p id="-v8mhia_27">C'est le probl&egrave;me de la <span class="control" id="-v8mhia_29">gestion de l'&eacute;tat</span> (State Management). L'&eacute;tat, c'est l'ensemble des donn&eacute;es qui d&eacute;finissent votre application &agrave; un instant T : qui est l'utilisateur connect&eacute; ? quel est le contenu du panier ? quelle est la liste de produits affich&eacute;e ?</p><p id="-v8mhia_28">Dans ce module, nous allons explorer pourquoi les m&eacute;thodes simples de communication ne suffisent plus lorsque l'application devient complexe. Nous allons ensuite construire notre premi&egrave;re solution, &eacute;l&eacute;gante et pragmatique, pour centraliser cet &eacute;tat : le service &quot;stateful&quot;. C'est la premi&egrave;re &eacute;tape fondamentale pour construire des applications fiables et maintenables.</p></section><section class="chapter"><h2 id="le-probl-me-prop-drilling-et-tat-incoh-rent" data-toc="le-probl-me-prop-drilling-et-tat-incoh-rent">Le Probl&egrave;me : &quot;Prop Drilling&quot; et &Eacute;tat Incoh&eacute;rent</h2><p id="-v8mhia_30">Quand on d&eacute;bute, on utilise deux m&eacute;canismes principaux pour faire communiquer les composants :</p><ol class="list _decimal" id="-v8mhia_31" type="1"><li class="list__item" id="-v8mhia_35"><p id="-v8mhia_37"><code class="code" id="-v8mhia_38">@Input()</code> pour passer des donn&eacute;es d'un parent &agrave; un enfant.</p></li><li class="list__item" id="-v8mhia_36"><p id="-v8mhia_39"><code class="code" id="-v8mhia_40">@Output()</code> et les &eacute;v&eacute;nements pour remonter une information d'un enfant &agrave; un parent.</p></li></ol><p id="-v8mhia_32">Mais que se passe-t-il quand le parent et l'enfant ne sont pas directs ?</p><section class="chapter"><h3 id="le-prop-drilling-forage-de-propri-t-s" data-toc="le-prop-drilling-forage-de-propri-t-s">Le &quot;Prop Drilling&quot; (Forage de propri&eacute;t&eacute;s)</h3><p id="-v8mhia_41">Imaginez cette hi&eacute;rarchie de composants : <code class="code" id="-v8mhia_46">App &gt; PageProduits &gt; ListeProduits &gt; CarteProduit</code>. La <code class="code" id="-v8mhia_47">PageProduits</code> d&eacute;tient l'information sur la devise &agrave; utiliser (ex: 'EUR'). La <code class="code" id="-v8mhia_48">CarteProduit</code>, tout en bas, a besoin de cette information pour afficher le prix.</p><p id="-v8mhia_42">Pour y arriver, vous allez devoir :</p><ol class="list _decimal" id="-v8mhia_43" type="1"><li class="list__item" id="-v8mhia_49"><p id="-v8mhia_51">Passer la devise de <code class="code" id="-v8mhia_52">PageProduits</code> &agrave; <code class="code" id="-v8mhia_53">ListeProduits</code> via un <code class="code" id="-v8mhia_54">@Input()</code>.</p></li><li class="list__item" id="-v8mhia_50"><p id="-v8mhia_55">Passer la devise de <code class="code" id="-v8mhia_56">ListeProduits</code> &agrave; <code class="code" id="-v8mhia_57">CarteProduit</code> via un autre <code class="code" id="-v8mhia_58">@Input()</code>.</p></li></ol><p id="-v8mhia_44">Le composant <code class="code" id="-v8mhia_59">ListeProduits</code> n'a rien &agrave; faire de cette devise ! Il ne fait que la transporter, comme un facteur. C'est &ccedil;a, le &quot;prop drilling&quot;. C'est fastidieux, et si vous devez ajouter un composant interm&eacute;diaire, vous devez penser &agrave; percer un nouveau &quot;trou&quot; pour la propri&eacute;t&eacute;.</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="325px" preserveAspectRatio="none" style="width:433px;height:325px;background:#FFFFFF;" version="1.1" viewBox="0 0 433 325" width="433px" zoomAndPan="magnify"><defs/><g><!--entity Page--><g id="elem_Page"><rect fill="#F1F1F1" height="52.9766" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="147" x="19" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="29" y="30.5352">PageProduits</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="33" y="47.0234">(d&#233;tient `devise`)</text></g><!--entity List--><g id="elem_List"><rect fill="#F1F1F1" height="52.9766" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="171" x="7" y="136.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="17" y="160.5152">ListeProduits</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="21" y="177.0034">(transporte `devise`)</text></g><!--entity Card--><g id="elem_Card"><rect fill="#F1F1F1" height="52.9766" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="22.5" y="266.95"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="32.5" y="290.4852">CarteProduit</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="36.5" y="306.9734">(utilise `devise`)</text></g><g id="elem_GMN7"><path d="M213,146.65 L213,159.47 L178.07,163.47 L213,167.47 L213,180.2711 A3.5,3.5 0 0 0 216.5,183.7711 L422.5,183.7711 A3.5,3.5 0 0 0 426,180.2711 L426,153.15 L416,143.15 L216.5,143.15 A3.5,3.5 0 0 0 213,146.65 " fill="#7FFFD4" style="stroke:#454645;stroke-width:1.5;"/><path d="M416,143.15 L416,151.4 A1.75,1.75 0 0 0 417.75,153.15 L426,153.15 L416,143.15 " fill="#7FFFD4" style="stroke:#454645;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="219" y="160.7184">Je ne me sers pas de `devise`,</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="219" y="176.0289">je ne fais que la passer.</text></g><!--link Page to List--><g id="link_Page_List"><path d="M92.5,60.39 C92.5,82.59 92.5,108.41 92.5,130.61 " fill="none" id="Page-to-List" style="stroke:#454645;stroke-width:1.0;"/><polygon fill="#454645" points="92.5,136.61,96.5,127.61,92.5,131.61,88.5,127.61,92.5,136.61" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="93.5" y="103.5484">`@Input() devise`</text></g><!--link List to Card--><g id="link_List_Card"><path d="M92.5,190.36 C92.5,212.57 92.5,238.39 92.5,260.58 " fill="none" id="List-to-Card" style="stroke:#454645;stroke-width:1.0;"/><polygon fill="#454645" points="92.5,266.58,96.5,257.58,92.5,261.58,88.5,257.58,92.5,266.58" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="93.5" y="233.5184">`@Input() devise`</text></g><!--SRC=[RP11JW9144NtVOelAqZ40xWm9AuqBaZSifY6BeRIcUgsgmRZaJm75xDx0eZ4zN_l_qhTs8vwmfxNsOivVMT9FliUczYdA2JsQbyT8TF6lBGTENTEC5dwbfOvXe5DiH9Cm-7Rk4PDe3qhDRC9lA9obzuBg_qLhSnhYjdeIgtefVheyraTpS6uA_YLLh3WNDt5FCHFcJ-CJRX7itYIDDXqXgFWnk14LV5VoaainsLkTuQuFRKz4uHGFgYK5QaiXzzJRbVoDkPRpugFWT3voXJsxWS0]--></g></svg></div></section><section class="chapter"><h3 id="l-tat-incoh-rent" data-toc="l-tat-incoh-rent">L'&Eacute;tat Incoh&eacute;rent</h3><p id="-v8mhia_60">Maintenant, imaginez que deux composants diff&eacute;rents et non li&eacute;s (ex: un <code class="code" id="-v8mhia_62">HeaderComponent</code> et un <code class="code" id="-v8mhia_63">ProfileComponent</code>) peuvent tous les deux modifier le nom de l'utilisateur. S'ils le font via un service simple qui n'a pas de &quot;m&eacute;moire&quot; de l'&eacute;tat, comment s'assurer que lorsque l'un met &agrave; jour le nom, l'autre est imm&eacute;diatement notifi&eacute; du changement ?</p><p id="-v8mhia_61">Sans un point central qui est la <span class="control" id="-v8mhia_64">source de v&eacute;rit&eacute; unique</span>, vous risquez de vous retrouver avec deux parties de votre UI qui affichent des informations contradictoires. C'est l'&eacute;tat incoh&eacute;rent.</p></section></section><section class="chapter"><h2 id="solution-1-le-service-stateful-avec-rxjs-l-approche-pragmatique" data-toc="solution-1-le-service-stateful-avec-rxjs-l-approche-pragmatique">Solution 1 : Le Service &quot;Stateful&quot; avec RxJS (L'approche pragmatique)</h2><p id="-v8mhia_65">La solution &agrave; ces deux probl&egrave;mes est de <span class="control" id="-v8mhia_72">centraliser l'&eacute;tat</span>. Au lieu que l'&eacute;tat soit &eacute;parpill&eacute; dans les composants, nous allons le confier &agrave; un gardien unique : un service sp&eacute;cial, dit &quot;stateful&quot; (qui a un &eacute;tat).</p><p id="-v8mhia_66">Le patron de conception est simple et tr&egrave;s puissant. Imaginez un service comme un coffre-fort :</p><ol class="list _decimal" id="-v8mhia_67" type="1"><li class="list__item" id="-v8mhia_73"><p id="-v8mhia_76"><span class="control" id="-v8mhia_77">L'&eacute;tat est priv&eacute; :</span> Le tr&eacute;sor (les donn&eacute;es) est &agrave; l'int&eacute;rieur, personne ne peut y toucher directement. On utilise pour cela un <code class="code" id="-v8mhia_78">BehaviorSubject</code> <span class="control" id="-v8mhia_79">priv&eacute;</span>.</p></li><li class="list__item" id="-v8mhia_74"><p id="-v8mhia_80"><span class="control" id="-v8mhia_81">On peut consulter l'&eacute;tat :</span> Le service expose une version &quot;lecture seule&quot; de l'&eacute;tat via un <code class="code" id="-v8mhia_82">Observable</code> public. Les composants peuvent s'abonner pour voir l'&eacute;tat, mais pas le modifier. On utilise pour cela la m&eacute;thode <code class="code" id="-v8mhia_83">.asObservable()</code>.</p></li><li class="list__item" id="-v8mhia_75"><p id="-v8mhia_84"><span class="control" id="-v8mhia_85">On demande une modification :</span> Le service expose des <span class="control" id="-v8mhia_86">m&eacute;thodes publiques</span> (<code class="code" id="-v8mhia_87">updateUser</code>, <code class="code" id="-v8mhia_88">loadProducts</code>...). C'est la seule porte d'entr&eacute;e pour demander un changement. Ces m&eacute;thodes sont les seules &agrave; pouvoir modifier le <code class="code" id="-v8mhia_89">BehaviorSubject</code> priv&eacute;.</p></li></ol><p id="-v8mhia_68"><span class="control" id="-v8mhia_90">Voici &agrave; quoi cela ressemble en pratique :</span></p><div class="code-block" data-lang="ts">
// user-state.service.ts
import {Injectable} from '@angular/core';
import {BehaviorSubject, Observable} from 'rxjs';

export interface User {
    id: number;
    name: string;
    email: string;
}

// L'état complet géré par ce service
interface UserState {
    currentUser: User | null;
    isLoading: boolean;
    error: string | null;
}

@Injectable({
    providedIn: 'root'
})
export class UserStateService {
    // 1. L'état est stocké dans un BehaviorSubject privé.
    // Il est initialisé avec un état de départ.
    private state$ = new BehaviorSubject&lt;UserState&gt;({
        currentUser: null,
        isLoading: false,
        error: null
    });

    // 2. On expose l'état en lecture seule via un Observable public.
    public currentUser$ = this.state$.asObservable();

    // 3. Méthodes publiques pour modifier l'état.
    public loadUser(id: number): void {
        // On met à jour l'état pour indiquer le chargement
        this.updateState({isLoading: true, error: null});

        // Simule un appel API
        // this.httpClient.get&lt;User&gt;(`/api/users/${id}`).subscribe({ ... })

        // Pour l'exemple, on simule une réponse réussie
        setTimeout(() =&gt; {
            const user: User = {id, name: 'Jane Doe', email: 'jane@doe.com'};
            this.updateState({currentUser: user, isLoading: false});
        }, 1000);
    }

    public clearUser(): void {
        this.updateState({currentUser: null});
    }

    // Méthode utilitaire privée pour mettre à jour l'état de manière sûre
    private updateState(partialState: Partial&lt;UserState&gt;): void {
        this.state$.next({
            ...this.state$.getValue(), // On récupère l'état actuel
            ...partialState           // On fusionne avec les nouvelles valeurs
        });
    }
}
</div><p id="-v8mhia_70">Avec cette approche, n'importe quel composant de l'application peut injecter <code class="code" id="-v8mhia_91">UserStateService</code> et s'abonner &agrave; <code class="code" id="-v8mhia_92">currentUser$</code> pour r&eacute;agir aux changements d'&eacute;tat, r&eacute;solvant &agrave; la fois le &quot;prop drilling&quot; et le risque d'incoh&eacute;rence.</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="380px" preserveAspectRatio="none" style="width:403px;height:380px;background:#FFFFFF;" version="1.1" viewBox="0 0 403 380" width="403px" zoomAndPan="magnify"><defs/><g><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="214" x="175" y="9.668">--up-|&gt; Service : "s'abonne &#224; currentUser$"</text><!--cluster Application--><g id="cluster_Application"><path d="M11.5,18.7773 L92.5,18.7773 A5.25,5.25 0 0 1 96,22.2773 L103,41.2656 L392.5,41.2656 A3.5,3.5 0 0 1 396,44.7656 L396,369.7373 A3.5,3.5 0 0 1 392.5,373.2373 L11.5,373.2373 A3.5,3.5 0 0 1 8,369.7373 L8,22.2773 A3.5,3.5 0 0 1 11.5,18.7773 " fill="none" style="stroke:#696969;stroke-width:1.0;"/><line style="stroke:#696969;stroke-width:1.0;" x1="8" x2="103" y1="41.2656" y2="41.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="82" x="12" y="34.3125">Application</text></g><!--cluster Service--><g id="cluster_Service"><path d="M112,79.7773 C112,69.7773 238,69.7773 238,69.7773 C238,69.7773 364,69.7773 364,79.7773 L364,178.2573 C364,188.2573 238,188.2573 238,188.2573 C238,188.2573 112,188.2573 112,178.2573 L112,79.7773 " fill="#00FFFF" style="stroke:#454645;stroke-width:1.0;"/><path d="M112,79.7773 C112,89.7773 238,89.7773 238,89.7773 C238,89.7773 364,89.7773 364,79.7773 " fill="none" style="stroke:#454645;stroke-width:1.0;"/><text fill="#454645" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="118" x="179" y="105.3125">UserStateService</text></g><!--entity Header--><g id="elem_Header"><rect fill="#F1F1F1" height="36.4883" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="150" x="173" y="224.2573"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="183" y="247.7925">HeaderComponent</text></g><!--entity Profile--><g id="elem_Profile"><rect fill="#F1F1F1" height="36.4883" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="145" x="234.5" y="320.7473"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="244.5" y="344.2825">ProfileComponent</text></g><!--entity Login--><g id="elem_Login"><rect fill="#F1F1F1" height="36.4883" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="24.5" y="320.7473"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="34.5" y="344.2825">LoginFormComponent</text></g><!--entity BS--><g id="elem_BS"><rect fill="#F1F1F1" height="36.4883" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="185" x="155.5" y="127.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="165.5" y="151.3125">state$ (BehaviorSubject)</text></g><!--reverse link Service to Profile--><g id="link_Service_Profile"><path d="M360,206.3919 C360,207.8051 360,193.3398 360,194.7673 C360,240.4473 360,292.9573 360,320.2773 " fill="none" id="Service-backto-Profile" style="stroke:#454645;stroke-width:1.0;"/><polygon fill="none" points="360,188.3919,354,206.3919,366,206.3919,360,188.3919" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="174.33" y="123.8057">s'abonne &#224; currentUser$</text></g><!--reverse link Service to Login--><g id="link_Service_Login"><path d="M120,206.8327 C120,207.8371 120,192.3507 120,193.376 C120,201.5782 120,210.4264 120,219.5661 C120,256.1248 120,297.3473 120,320.5473 " fill="none" id="Service-backto-Login" style="stroke:#454645;stroke-width:1.0;"/><polygon fill="none" points="120,188.8327,114,206.8327,126,206.8327,120,188.8327" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="7" y="230.1257">appelle loadUser()</text></g><!--link Service to BS--><g id="link_Service_BS"><path d="M120.82,146.2373 C124.22,146.2373 131.92,146.2373 149.15,146.2373 " fill="none" id="Service-to-BS" style="stroke:#454645;stroke-width:1.0;"/><polygon fill="#454645" points="155.15,146.2373,146.15,142.2373,150.15,146.2373,146.15,150.2373,155.15,146.2373" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="40.98" y="142.8057">.next(newState)</text></g><!--link BS to Header--><g id="link_BS_Header"><path d="M248,164.6173 C248,181.7073 248,200.8873 248,217.9573 " fill="none" id="BS-to-Header" style="stroke:#454645;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#454645" points="248,223.9573,252,214.9573,248,218.9573,244,214.9573,248,223.9573" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="206" y="190.8557">notifie</text></g><!--link BS to Profile--><g id="link_BS_Profile"><path d="M331.75,164.5173 C331.75,201.3073 331.75,277.2873 331.75,314.2573 " fill="none" id="BS-to-Profile" style="stroke:#454645;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#454645" points="331.75,320.2573,335.75,311.2573,331.75,315.2573,327.75,311.2573,331.75,320.2573" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="332.75" y="238.9557">notifie</text></g><!--SRC=[bP11JiCm44NtFiKGLQ9Tf0TW4OaY8HOia29MYCKacQQcpepbJ0CLS1VkmiLmqgIq4XlaZVN_- -C_lj0DDGITBGAo6jDkBNiCs40fZHScrbptZY1GgSYrenF4MIRTUm89kX5ZF9PRh0cIQ- -TBL6jS0BlvZWAdku8Ameta_0CsC91EwKUWgojetDi54-vUwajtqfepib1DgP2nGBRsEUnfP0hAkKKEbjIqbFZFVOxxWP9srCpcAzeWvsLaE-Ab-WkXiGgDv_nc4DXIDETJp-ouw2h6B_4GfW9lh-Wt8KG6_Llpn8pjlzVQ5ZahmXwJovESu9LpyuNYJ6JdsQnQKyjcTvqplGwx1wHA2-NsVZXaM1HkxOqwLF7N-C7]--></g></svg></div></section><section class="chapter"><h2 id="exercice-2-1-cr-er-un-store-fait-main-pour-une-liste-de-t-ches" data-toc="exercice-2-1-cr-er-un-store-fait-main-pour-une-liste-de-t-ches">Exercice 2.1 : Cr&eacute;er un Store &quot;fait-main&quot; pour une liste de t&acirc;ches</h2><p id="-v8mhia_93"><span class="control" id="-v8mhia_99">Objectif :</span> Appliquer le patron du service &quot;stateful&quot; pour g&eacute;rer une liste de t&acirc;ches (To-Do list).</p><p id="-v8mhia_94"><span class="control" id="-v8mhia_100">Instructions :</span></p><ol class="list _decimal" id="-v8mhia_95" type="1"><li class="list__item" id="-v8mhia_101"><p id="-v8mhia_105"><span class="control" id="-v8mhia_106">Cr&eacute;ez une interface <code class="code" id="-v8mhia_111">Task</code></span> dans un fichier <code class="code" id="-v8mhia_107">task.model.ts</code> avec les champs <code class="code" id="-v8mhia_108">id</code> (number), <code class="code" id="-v8mhia_109">title</code> (string), et <code class="code" id="-v8mhia_110">completed</code> (boolean).</p></li><li class="list__item" id="-v8mhia_102"><p id="-v8mhia_112"><span class="control" id="-v8mhia_113">Cr&eacute;ez une interface <code class="code" id="-v8mhia_115">TasksState</code></span> qui contiendra un tableau <code class="code" id="-v8mhia_114">tasks: Task[]</code>.</p></li><li class="list__item" id="-v8mhia_103"><p id="-v8mhia_116"><span class="control" id="-v8mhia_118">Cr&eacute;ez un <code class="code" id="-v8mhia_119">TaskStateService</code></span>:</p><ul class="list _bullet" id="-v8mhia_117"><li class="list__item" id="-v8mhia_120"><p id="-v8mhia_124">Il doit contenir un <code class="code" id="-v8mhia_125">BehaviorSubject&lt;TasksState&gt;</code> priv&eacute;, initialis&eacute; avec une liste de t&acirc;ches vide.</p></li><li class="list__item" id="-v8mhia_121"><p id="-v8mhia_126">Il doit exposer un <code class="code" id="-v8mhia_127">Observable</code> public <code class="code" id="-v8mhia_128">tasks$</code> qui s&eacute;lectionne le tableau de t&acirc;ches de l'&eacute;tat. (Astuce: <code class="code" id="-v8mhia_129">this.state$.pipe(map(state =&gt; state.tasks))</code>).</p></li><li class="list__item" id="-v8mhia_122"><p id="-v8mhia_130">Il doit avoir une m&eacute;thode publique <code class="code" id="-v8mhia_131">addTask(title: string)</code> qui cr&eacute;e une nouvelle t&acirc;che, l'ajoute &agrave; la liste actuelle et met &agrave; jour l'&eacute;tat.</p></li><li class="list__item" id="-v8mhia_123"><p id="-v8mhia_132">Il doit avoir une m&eacute;thode publique <code class="code" id="-v8mhia_133">toggleTaskCompleted(taskId: number)</code> qui trouve la t&acirc;che correspondante, inverse son statut <code class="code" id="-v8mhia_134">completed</code>, et met &agrave; jour l'&eacute;tat.</p></li></ul></li><li class="list__item" id="-v8mhia_104"><p id="-v8mhia_135">Vous pouvez utiliser le composant ci-dessous pour tester votre service.</p></li></ol><p id="-v8mhia_96"><span class="control" id="-v8mhia_136">Composant de test (&agrave; placer dans votre <code class="code" id="-v8mhia_137">app.component.ts</code> par exemple) :</span></p><div class="code-block" data-lang="ts">
import {Component, inject} from '@angular/core';
import {CommonModule} from '@angular/common';
import {TaskStateService} from './task-state.service'; // Adaptez le chemin

@Component({
    selector: 'app-root',
    standalone: true,
    imports: [CommonModule],
    template: `
    &lt;h1&gt;Ma liste de tâches&lt;/h1&gt;
    &lt;button (click)=&quot;addTask('Apprendre la gestion d-état')&quot;&gt;
      Ajouter Tâche
    &lt;/button&gt;
    &lt;ul&gt;
      &lt;li *ngFor=&quot;let task of tasks$ | async&quot; 
          (click)=&quot;toggleTask(task.id)&quot;
          [style.textDecoration]=&quot;task.completed ? 'line-through' : 'none'&quot;&gt;
        {{ task.title }}
      &lt;/li&gt;
    &lt;/ul&gt;
  `
})
export class AppComponent {
    private taskStateService = inject(TaskStateService);

    tasks$ = this.taskStateService.tasks$;

    addTask(title: string): void {
        this.taskStateService.addTask(title);
    }

    toggleTask(id: number): void {
        this.taskStateService.toggleTaskCompleted(id);
    }
}
</div><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-2-1" data-toc="correction-exercice-2-1">Correction exercice 2.1</h3></div><div class="collapse__content"><section class="procedure-steps" id="-v8mhia_138"><p id="-v8mhia_139">Voici l'impl&eacute;mentation du mod&egrave;le et du service stateful pour la liste de t&acirc;ches.</p><p id="-v8mhia_140"><span class="control" id="-v8mhia_144">1. Le mod&egrave;le de donn&eacute;es <code class="code" id="-v8mhia_145">task.model.ts</code></span></p><div class="code-block" data-lang="ts">
// src/app/task.model.ts
export interface Task {
    id: number;
    title: string;
    completed: boolean;
}

export interface TasksState {
    tasks: Task[];
}
</div><p id="-v8mhia_142"><span class="control" id="-v8mhia_146">2. Le service d'&eacute;tat <code class="code" id="-v8mhia_147">task-state.service.ts</code></span></p><div class="code-block" data-lang="ts">
// src/app/task-state.service.ts
import {Injectable} from '@angular/core';
import {BehaviorSubject, Observable} from 'rxjs';
import {map} from 'rxjs/operators';
import {Task, TasksState} from './task.model';

@Injectable({
    providedIn: 'root'
})
export class TaskStateService {
    // État initial
    private initialState: TasksState = {
        tasks: [
            {id: 1, title: 'Terminer le module RxJS', completed: true}
        ]
    };

    // Le BehaviorSubject privé qui détient l'état
    private state$ = new BehaviorSubject&lt;TasksState&gt;(this.initialState);

    // L'Observable public pour consommer la liste des tâches
    public tasks$: Observable&lt;Task[]&gt; = this.state$.pipe(
        map(state =&gt; state.tasks)
    );

    // Méthode publique pour ajouter une tâche
    public addTask(title: string): void {
        const currentState = this.state$.getValue();
        const newTask: Task = {
            id: currentState.tasks.length + 1, // Logique d'ID simpliste
            title,
            completed: false
        };

        // Création du nouvel état
        const newState: TasksState = {
            tasks: [...currentState.tasks, newTask]
        };

        // On pousse le nouvel état dans le BehaviorSubject
        this.state$.next(newState);
    }

    // Méthode publique pour basculer le statut d'une tâche
    public toggleTaskCompleted(taskId: number): void {
        const currentState = this.state$.getValue();

        const updatedTasks = currentState.tasks.map(task =&gt;
            task.id === taskId ? {...task, completed: !task.completed} : task
        );

        const newState: TasksState = {
            tasks: updatedTasks
        };

        this.state$.next(newState);
    }
}
</div><ol class="list _decimal"></ol></section></div></div></section></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><ol class="list _decimal" id="-v8mhia_148" type="1"><li class="list__item" id="-v8mhia_149"><p id="-v8mhia_154"><span class="control" id="-v8mhia_155">Qu'est-ce que le &quot;prop drilling&quot; ?</span> a. Une technique pour optimiser le rendu des composants. b. Le fait de devoir passer des donn&eacute;es &agrave; travers plusieurs niveaux de composants interm&eacute;diaires qui n'en ont pas besoin. c. Une erreur qui se produit lors de l'injection de d&eacute;pendances. d. Le processus d'extraction des donn&eacute;es d'un formulaire.</p></li><li class="list__item" id="-v8mhia_150"><p id="-v8mhia_156"><span class="control" id="-v8mhia_157">Dans le patron du service &quot;stateful&quot;, pourquoi expose-t-on l'&eacute;tat via <code class="code" id="-v8mhia_158">.asObservable()</code> plut&ocirc;t que de donner acc&egrave;s directement au <code class="code" id="-v8mhia_159">BehaviorSubject</code>?</span></p></li><li class="list__item" id="-v8mhia_151"><p id="-v8mhia_160"><span class="control" id="-v8mhia_161">Quel est l'avantage principal d'utiliser un <code class="code" id="-v8mhia_162">BehaviorSubject</code> plut&ocirc;t qu'un <code class="code" id="-v8mhia_163">Subject</code> simple pour g&eacute;rer un &eacute;tat ?</span> a. Il est plus performant. b. Il fournit la derni&egrave;re valeur de l'&eacute;tat &agrave; tout nouvel abonn&eacute;. c. Il peut g&eacute;rer plusieurs types de donn&eacute;es. d. Il g&egrave;re automatiquement les erreurs.</p></li><li class="list__item" id="-v8mhia_152"><p id="-v8mhia_164"><span class="control" id="-v8mhia_165">Comment un composant doit-il demander une modification de l'&eacute;tat lorsqu'on utilise un service &quot;stateful&quot; ?</span> a. En modifiant directement la propri&eacute;t&eacute; publique du service. b. En &eacute;mettant un &eacute;v&eacute;nement global. c. En appelant une m&eacute;thode publique expos&eacute;e par le service. d. En utilisant la fonction <code class="code" id="-v8mhia_166">inject()</code> avec un token sp&eacute;cial.</p></li><li class="list__item" id="-v8mhia_153"><p id="-v8mhia_167"><span class="control" id="-v8mhia_168">Citez un inconv&eacute;nient potentiel de cette approche de &quot;store fait-main&quot; pour une application tr&egrave;s grande et complexe.</span></p></li></ol></section><section class="chapter"><h2 id="conclusion" data-toc="conclusion">Conclusion</h2><p id="-v8mhia_169">Vous venez de mettre en place votre premier syst&egrave;me de gestion d'&eacute;tat ! Le patron du service &quot;stateful&quot; avec RxJS est une solution <span class="control" id="-v8mhia_172">extr&ecirc;mement efficace et pragmatique</span> pour une grande majorit&eacute; d'applications Angular. Il r&eacute;sout les probl&egrave;mes de &quot;prop drilling&quot; et d'&eacute;tat incoh&eacute;rent en cr&eacute;ant une source de v&eacute;rit&eacute; unique, centralis&eacute;e et r&eacute;active.</p><p id="-v8mhia_170">Cependant, &agrave; mesure que l'application et l'&eacute;quipe grandissent, cette approche peut montrer ses limites : la logique de modification est diss&eacute;min&eacute;e dans les m&eacute;thodes, il n'y a pas d'outils de d&eacute;bogage pour voir l'historique des changements d'&eacute;tat, et il n'y a pas de cadre strict pour g&eacute;rer les effets secondaires (comme les appels API).</p><p id="-v8mhia_171">Pour r&eacute;pondre &agrave; ces d&eacute;fis, des biblioth&egrave;ques plus structur&eacute;es ont &eacute;t&eacute; cr&eacute;&eacute;es. Dans la partie &quot;Pour aller plus loin&quot;, nous allons d&eacute;couvrir la plus c&eacute;l&egrave;bre d'entre elles : <span class="control" id="-v8mhia_173">NgRx</span>, l'impl&eacute;mentation du patron Redux pour Angular. Pr&eacute;parez-vous &agrave; entrer dans un monde encore plus structur&eacute; et puissant</p></section><div class="last-modified">12 octobre 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="001-01-advanced-rxjs.html" class="navigation-links__prev">Module 1 : Pour aller plus loin - L'Art de la Composition et de la R&eacute;silience</a><a href="002-01-ngrx.html" class="navigation-links__next">Module 2 : Pour aller plus loin - Introduction &agrave; NgRx (L'approche Redux)</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>