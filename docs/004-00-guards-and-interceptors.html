<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-31T14:21:25.663829"><title>Module 4 : L'essentiel - Gardiens et Intercepteurs, les Ma&icirc;tres du Flux | Angular avancé</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"les-route-guards-prot-ger-vos-routes","level":0,"title":"Les Route Guards : Protéger vos Routes","anchor":"#les-route-guards-prot-ger-vos-routes"},{"id":"les-http-interceptors-la-douane-de-vos-donn-es","level":0,"title":"Les HTTP Interceptors : La Douane de vos Données","anchor":"#les-http-interceptors-la-douane-de-vos-donn-es"},{"id":"exercice-4-1-prot-ger-une-section-profil","level":0,"title":"Exercice 4.1 : Protéger une section \"Profil\"","anchor":"#exercice-4-1-prot-ger-une-section-profil"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"},{"id":"conclusion","level":0,"title":"Conclusion","anchor":"#conclusion"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 4 : L'essentiel - Gardiens et Intercepteurs, les Ma&icirc;tres du Flux | Angular avancé"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Angular avancé Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/004-00-guards-and-interceptors.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 4 : L'essentiel - Gardiens et Intercepteurs, les Ma&icirc;tres du Flux | Angular avancé"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/004-00-guards-and-interceptors.html#webpage",
    "url": "writerside-documentation/004-00-guards-and-interceptors.html",
    "name": "Module 4 : L'essentiel - Gardiens et Intercepteurs, les Ma&icirc;tres du Flux | Angular avancé",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Angular avancé Help"
}</script><!-- End Schema.org --></head><body data-id="004-00-guards-and-interceptors" data-main-title="Module 4 : L'essentiel - Gardiens et Intercepteurs, les Maîtres du Flux" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Angular avancé  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="004-00-guards-and-interceptors" id="004-00-guards-and-interceptors.md">Module 4 : L'essentiel - Gardiens et Intercepteurs, les Maîtres du Flux</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h2><p id="csjpv5_10">&Agrave; la fin de ce module, vous serez en mesure de :</p><ul class="list _bullet" id="csjpv5_11"><li class="list__item" id="csjpv5_12"><p id="csjpv5_16"><span class="control" id="csjpv5_17">S&eacute;curiser</span> l'acc&egrave;s &agrave; vos routes en utilisant les <code class="code" id="csjpv5_18">Route Guards</code> (<code class="code" id="csjpv5_19">CanActivate</code>).</p></li><li class="list__item" id="csjpv5_13"><p id="csjpv5_20"><span class="control" id="csjpv5_21">Pr&eacute;venir</span> la perte de donn&eacute;es en emp&ecirc;chant l'utilisateur de quitter une route avec des changements non sauvegard&eacute;s (<code class="code" id="csjpv5_22">CanDeactivate</code>).</p></li><li class="list__item" id="csjpv5_14"><p id="csjpv5_23"><span class="control" id="csjpv5_24">Comprendre</span> le concept de middleware pour les requ&ecirc;tes HTTP avec les <code class="code" id="csjpv5_25">HttpInterceptors</code>.</p></li><li class="list__item" id="csjpv5_15"><p id="csjpv5_26"><span class="control" id="csjpv5_27">Impl&eacute;menter</span> un intercepteur pour ajouter un jeton d'authentification &agrave; toutes vos requ&ecirc;tes sortantes de mani&egrave;re centralis&eacute;e.</p></li></ul></section><section class="chapter"><h2 id="introduction" data-toc="introduction">Introduction</h2><p id="csjpv5_28">Votre application commence &agrave; prendre forme. Vous avez des sections distinctes, peut-&ecirc;tre m&ecirc;me une section &quot; Administration&quot; ou un &quot;Espace Membre&quot;. Une question &eacute;vidente se pose : comment s'assurer que seules les bonnes personnes peuvent y acc&eacute;der ?</p><p id="csjpv5_29">Imaginez votre application comme un b&acirc;timent de prestige. Vous ne laisseriez pas n'importe qui entrer dans le bureau du PDG. Il vous faut un agent de s&eacute;curit&eacute; &agrave; la porte. C'est exactement le r&ocirc;le des <span class="control" id="csjpv5_32"><code class="code" id="csjpv5_33">Route Guards</code></span>. Ils se placent avant l'acc&egrave;s &agrave; une route et d&eacute;cident si la navigation peut continuer.</p><p id="csjpv5_30">Maintenant, imaginez que tous les colis qui entrent et sortent de ce b&acirc;timent doivent passer par un bureau de douane central pour &ecirc;tre inspect&eacute;s, &eacute;tiquet&eacute;s ou estampill&eacute;s. Ce bureau de douane, c'est votre <span class="control" id="csjpv5_34"><code class="code" id="csjpv5_35">HttpInterceptor</code></span>. Il permet d'attraper, d'inspecter et de modifier chaque requ&ecirc;te HTTP qui part de votre application, et chaque r&eacute;ponse qui arrive.</p><p id="csjpv5_31">Dans ce module, nous allons apprendre &agrave; ma&icirc;triser ces deux outils fondamentaux qui op&egrave;rent &agrave; la crois&eacute;e des chemins de votre application, pour contr&ocirc;ler les flux de navigation et de donn&eacute;es.</p></section><section class="chapter"><h2 id="les-route-guards-prot-ger-vos-routes" data-toc="les-route-guards-prot-ger-vos-routes">Les Route Guards : Prot&eacute;ger vos Routes</h2><p id="csjpv5_36">Un &quot;Guard&quot; est simplement une fonction ou une classe qui retourne un <code class="code" id="csjpv5_38">boolean</code>, une <code class="code" id="csjpv5_39">Promise&lt;boolean&gt;</code>, ou un <code class="code" id="csjpv5_40">Observable&lt;boolean&gt;</code>. Le routeur Angular ex&eacute;cute cette logique avant d'activer une route et attend la r&eacute;ponse. Si la r&eacute;ponse est <code class="code" id="csjpv5_41">true</code>, la navigation continue. Si c'est <code class="code" id="csjpv5_42">false</code>, elle est annul&eacute;e.</p><div class="tabs" id="csjpv5_37" data-anchors="[csjpv5_43,csjpv5_44]"><div class="tabs__content" data-gtm="tab" id="csjpv5_43" data-title="CanActivate : Le Videur"><p>`CanActivate` est le garde le plus courant. Il r&eacute;pond &agrave; la question : &quot;L'utilisateur a-t-il le droit d'acc&eacute;der &agrave; cette route ?&quot;. Le cas d'usage le plus fr&eacute;quent est la gestion de l'authentification. </p><p id="csjpv5_45"><span class="control" id="csjpv5_50">Comment &ccedil;a marche ?</span></p><ol class="list _decimal" id="csjpv5_46" type="1"><li class="list__item" id="csjpv5_51"><p id="csjpv5_55">On cr&eacute;e une fonction (ou une classe <code class="code" id="csjpv5_56">Injectable</code>) qui contient notre logique.</p></li><li class="list__item" id="csjpv5_52"><p id="csjpv5_57">Cette fonction a acc&egrave;s aux services n&eacute;cessaires (ex: <code class="code" id="csjpv5_58">AuthService</code>).</p></li><li class="list__item" id="csjpv5_53"><p id="csjpv5_59">Elle retourne <code class="code" id="csjpv5_60">true</code> si l'utilisateur est authentifi&eacute;, <code class="code" id="csjpv5_61">false</code> sinon (et peut m&ecirc;me le rediriger vers la page de connexion).</p></li><li class="list__item" id="csjpv5_54"><p id="csjpv5_62">On applique ce garde &agrave; la route que l'on veut prot&eacute;ger.</p></li></ol><div class="code-block" data-lang="ts" data-title="TypeScript">
// src/app/auth/auth.guard.ts
import {inject} from '@angular/core';
import {Router} from '@angular/router';
import {AuthService} from './auth.service';

// Une fonction garde est l'approche moderne et concise
export const authGuard = () =&gt; {
    const authService = inject(AuthService);
    const router = inject(Router);

    if (authService.isLoggedIn()) {
        return true; // L'utilisateur peut passer
    }

    // L'utilisateur n'est pas connecté, on le redirige
    return router.parseUrl('/login');
};
</div><div class="code-block" data-lang="ts" data-title="TypeScript">
// src/app/app.routes.ts
import {Routes} from '@angular/router';
import {authGuard} from './auth/auth.guard';
import {AdminDashboardComponent} from './admin/admin-dashboard.component';

export const routes: Routes = [
    // ...
    {
        path: 'admin',
        component: AdminDashboardComponent,
        canActivate: [authGuard] // On applique notre garde ici
    }
];
</div><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="371px" preserveAspectRatio="none" style="width:557px;height:371px;background:#FFFFFF;" version="1.1" viewBox="0 0 557 371" width="557px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="152.5527" style="stroke:#222222;stroke-width:1.0;" width="10" x="208.5" y="112.7988"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#222222;stroke-width:1.0;" width="10" x="383.5" y="142.1094"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#222222;stroke-width:1.0;" width="10" x="498.5" y="171.4199"/><line style="stroke:#222222;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="81.4883" y2="290.3516"/><line style="stroke:#222222;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="213.5" x2="213.5" y1="81.4883" y2="290.3516"/><line style="stroke:#222222;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="388" x2="388" y1="81.4883" y2="290.3516"/><line style="stroke:#222222;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="503" x2="503" y1="81.4883" y2="290.3516"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="78.5352">User</text><ellipse cx="23.5" cy="13.5" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:0.5;"/><path d="M23.5,21.5 L23.5,48.5 M10.5,29.5 L36.5,29.5 M23.5,48.5 L10.5,63.5 M23.5,48.5 L36.5,63.5 " fill="none" style="stroke:#454645;stroke-width:0.5;"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="302.8867">User</text><ellipse cx="23.5" cy="314.3398" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:0.5;"/><path d="M23.5,322.3398 L23.5,349.3398 M10.5,330.3398 L36.5,330.3398 M23.5,349.3398 L10.5,364.3398 M23.5,349.3398 L36.5,364.3398 " fill="none" style="stroke:#454645;stroke-width:0.5;"/><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="60" x="183.5" y="50"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="190.5" y="70.5352">Router</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="60" x="183.5" y="289.3516"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="190.5" y="309.8867">Router</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="89" x="344" y="50"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="351" y="70.5352">AuthGuard</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="89" x="344" y="289.3516"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="351" y="309.8867">AuthGuard</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="95" x="456" y="50"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="463" y="70.5352">AuthService</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="95" x="456" y="289.3516"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="463" y="309.8867">AuthService</text><rect fill="#FFFFFF" height="152.5527" style="stroke:#222222;stroke-width:1.0;" width="10" x="208.5" y="112.7988"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#222222;stroke-width:1.0;" width="10" x="383.5" y="142.1094"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#222222;stroke-width:1.0;" width="10" x="498.5" y="171.4199"/><polygon fill="#222222" points="196.5,108.7988,206.5,112.7988,196.5,116.7988,200.5,112.7988" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;" x1="23.5" x2="202.5" y1="112.7988" y2="112.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="30.5" y="108.0566">Clique sur le lien "/admin"</text><polygon fill="#222222" points="371.5,138.1094,381.5,142.1094,371.5,146.1094,375.5,142.1094" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;" x1="218.5" x2="377.5" y1="142.1094" y2="142.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="225.5" y="137.3672">canActivate() ?</text><polygon fill="#222222" points="486.5,167.4199,496.5,171.4199,486.5,175.4199,490.5,171.4199" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;" x1="393.5" x2="492.5" y1="171.4199" y2="171.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="400.5" y="166.6777">isLoggedIn() ?</text><polygon fill="#222222" points="404.5,196.7305,394.5,200.7305,404.5,204.7305,400.5,200.7305" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="398.5" x2="502.5" y1="200.7305" y2="200.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="410.5" y="195.9883">true</text><polygon fill="#222222" points="229.5,226.041,219.5,230.041,229.5,234.041,225.5,230.041" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="223.5" x2="387.5" y1="230.041" y2="230.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="235.5" y="225.2988">true</text><line style="stroke:#222222;stroke-width:1.0;" x1="218.5" x2="260.5" y1="264.3516" y2="264.3516"/><line style="stroke:#222222;stroke-width:1.0;" x1="260.5" x2="260.5" y1="264.3516" y2="277.3516"/><line style="stroke:#222222;stroke-width:1.0;" x1="213.5" x2="260.5" y1="277.3516" y2="277.3516"/><polygon fill="#222222" points="223.5,273.3516,213.5,277.3516,223.5,281.3516,219.5,277.3516" style="stroke:#222222;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="225.5" y="259.6094">Active la route "/admin"</text><!--SRC=[TP2zRW8n48HxFyM6DAH0I9GKYIuKKQIhG7c0ZRt0AdSsMTkN8igxumE3Zv-uytg-cLa_X2sr11r_2jgW_1VR7GgsuEaxajK4lweISJyBrpY1nzdXg9hNLBEbLoU6vFBjJw4EwVxXILGo2wnvbynXwMAu6bKnRDyYYhcPhaWwrgHKRmEJvqp371ODfshWeq13q31P64tHj6n7VJ9t6EYKbQ64dvEIWqPRPU7u2LuALUeKUMPpdqIphzrcG-RTtiAdraDYSfKU998oz2-NOuShtqEEFSk2P_5XjVGn2DAFokSC38xYFG00]--></g></svg></div></div><div class="tabs__content" data-gtm="tab" id="csjpv5_44" data-title="CanDeactivate : L'Avertissement de Sortie"><p>`CanDeactivate` est diff&eacute;rent. Il se d&eacute;clenche quand on essaie de **quitter** une route. Il r&eacute;pond &agrave; la question : &quot;L'utilisateur a-t-il le droit de quitter cette page ?&quot;. C'est l'outil parfait pour &eacute;viter la perte de donn&eacute;es, par exemple lorsqu'un formulaire a &eacute;t&eacute; modifi&eacute; mais pas encore sauvegard&eacute;. </p><p id="csjpv5_63">Pour le rendre r&eacute;utilisable, on cr&eacute;e une interface que nos composants devront impl&eacute;menter.</p><div class="code-block" data-lang="ts" data-title="TypeScript">
// src/app/guards/confirm-deactivate.guard.ts
import {CanDeactivateFn} from '@angular/router';
import {Observable} from 'rxjs';

// Le composant qui veut être protégé par ce garde
// doit implémenter cette interface.
export interface CanComponentDeactivate {
    canDeactivate: () =&gt; Observable&lt;boolean&gt; | Promise&lt;boolean&gt; | boolean;
}

export const confirmDeactivateGuard: CanDeactivateFn&lt;CanComponentDeactivate&gt; =
    (component, currentRoute, currentState, nextState) =&gt; {
        // Le garde appelle la méthode du composant lui-même
        // pour savoir s'il peut être désactivé.
        return component.canDeactivate ? component.canDeactivate() : true;
    };
</div><div class="code-block" data-lang="ts" data-title="TypeScript">
// src/app/components/user-form/user-form.component.ts
import {Component} from '@angular/core';
import {CanComponentDeactivate}
    from '../../guards/confirm-deactivate.guard.ts';

@Component({...})
export class UserFormComponent implements CanComponentDeactivate {
    isFormDirty = false; // Simule un formulaire modifié

    canDeactivate(): boolean {
        if (this.isFormDirty) {
            return confirm('Vous avez des modifications non enregistrées. Quitter ?');
        }
        return true;
    }
}
</div></div></div></section><section class="chapter"><h2 id="les-http-interceptors-la-douane-de-vos-donn-es" data-toc="les-http-interceptors-la-douane-de-vos-donn-es">Les HTTP Interceptors : La Douane de vos Donn&eacute;es</h2><p id="csjpv5_66">Un intercepteur est un service qui s'interpose entre votre code qui utilise <code class="code" id="csjpv5_73">HttpClient</code> et le backend. Il vous permet d'op&eacute;rer sur toutes les requ&ecirc;tes sortantes et toutes les r&eacute;ponses entrantes depuis un seul et unique endroit.</p><p id="csjpv5_67"><span class="control" id="csjpv5_74">Pourquoi est-ce si puissant ?</span> Imaginez que vous devez ajouter un header d'authentification &agrave; 50 appels API diff&eacute;rents, r&eacute;partis dans 20 services. Sans intercepteur, c'est un copier-coller cauchemardesque. Avec un intercepteur, vous l'&eacute;crivez <span class="control" id="csjpv5_75">une seule fois</span>.</p><p id="csjpv5_68"><span class="control" id="csjpv5_76">Comment &ccedil;a marche ?</span> Un intercepteur est une fonction qui re&ccedil;oit la requ&ecirc;te (<code class="code" id="csjpv5_77">HttpRequest</code>) et un &quot;handler&quot; (<code class="code" id="csjpv5_78">HttpHandler</code>). Son travail est de passer la requ&ecirc;te (potentiellement modifi&eacute;e) au handler suivant dans la cha&icirc;ne, via <code class="code" id="csjpv5_79">next.handle(request)</code>.</p><div class="code-block" data-lang="ts">
// src/app/auth/auth.interceptor.ts
import {HttpInterceptorFn} from '@angular/common/http';
import {inject} from '@angular/core';
import {AuthService} from './auth.service';

export const authInterceptor: HttpInterceptorFn = (req, next) =&gt; {
    const authService = inject(AuthService);
    const authToken = authService.getToken();

    // Si pas de token, on ne fait rien
    if (!authToken) {
        return next(req);
    }

    // Les requêtes sont immuables, on doit donc la cloner
    // pour y ajouter le header.
    const authReq = req.clone({
        setHeaders: {
            Authorization: `Bearer ${authToken}`
        }
    });

    // On passe la requête modifiée au handler suivant.
    return next(authReq);
};
</div><p id="csjpv5_70">Pour l'activer, on le fournit dans la configuration de l'application :</p><div class="code-block" data-lang="ts">
// src/app/app.config.ts
import {ApplicationConfig} from '@angular/core';
import {provideHttpClient, withInterceptors} from '@angular/common/http';
import {authInterceptor} from './auth/auth.interceptor';

export const appConfig: ApplicationConfig = {
    providers: [
        // ...
        // Active HttpClient et enregistre notre intercepteur
        provideHttpClient(withInterceptors([authInterceptor]))
    ]
};
</div><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="310px" preserveAspectRatio="none" style="width:617px;height:310px;background:#FFFFFF;" version="1.1" viewBox="0 0 617 310" width="617px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="188.8633" style="stroke:#222222;stroke-width:1.0;" width="10" x="225.5" y="67.7988"/><rect fill="#FFFFFF" height="130.2422" style="stroke:#222222;stroke-width:1.0;" width="10" x="409.5" y="97.1094"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#222222;stroke-width:1.0;" width="10" x="588.5" y="168.7305"/><line style="stroke:#222222;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="51" x2="51" y1="36.4883" y2="274.6621"/><line style="stroke:#222222;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="230" x2="230" y1="36.4883" y2="274.6621"/><line style="stroke:#222222;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="414" x2="414" y1="36.4883" y2="274.6621"/><line style="stroke:#222222;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="593.5" x2="593.5" y1="36.4883" y2="274.6621"/><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="93" x="5" y="5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="12" y="25.5352">DataService</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="93" x="5" y="273.6621"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="12" y="294.1973">DataService</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="83" x="189" y="5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="196" y="25.5352">HttpClient</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="83" x="189" y="273.6621"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="196" y="294.1973">HttpClient</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="123" x="353" y="5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="360" y="25.5352">AuthInterceptor</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="123" x="353" y="273.6621"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="360" y="294.1973">AuthInterceptor</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="36" x="575.5" y="5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="582.5" y="25.5352">API</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="36" x="575.5" y="273.6621"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="582.5" y="294.1973">API</text><rect fill="#FFFFFF" height="188.8633" style="stroke:#222222;stroke-width:1.0;" width="10" x="225.5" y="67.7988"/><rect fill="#FFFFFF" height="130.2422" style="stroke:#222222;stroke-width:1.0;" width="10" x="409.5" y="97.1094"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#222222;stroke-width:1.0;" width="10" x="588.5" y="168.7305"/><polygon fill="#222222" points="213.5,63.7988,223.5,67.7988,213.5,71.7988,217.5,67.7988" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;" x1="51.5" x2="219.5" y1="67.7988" y2="67.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="58.5" y="63.0566">get('/data')</text><polygon fill="#222222" points="397.5,93.1094,407.5,97.1094,397.5,101.1094,401.5,97.1094" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;" x1="235.5" x2="403.5" y1="97.1094" y2="97.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="242.5" y="92.3672">intercept(req, next)</text><line style="stroke:#222222;stroke-width:1.0;" x1="419.5" x2="461.5" y1="126.4199" y2="126.4199"/><line style="stroke:#222222;stroke-width:1.0;" x1="461.5" x2="461.5" y1="126.4199" y2="139.4199"/><line style="stroke:#222222;stroke-width:1.0;" x1="420.5" x2="461.5" y1="139.4199" y2="139.4199"/><polygon fill="#222222" points="430.5,135.4199,420.5,139.4199,430.5,143.4199,426.5,139.4199" style="stroke:#222222;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="426.5" y="121.6777">req.clone() + add Header</text><polygon fill="#222222" points="576.5,164.7305,586.5,168.7305,576.5,172.7305,580.5,168.7305" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;" x1="419.5" x2="582.5" y1="168.7305" y2="168.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="426.5" y="163.9883">next.handle(authReq)</text><polygon fill="#222222" points="430.5,194.041,420.5,198.041,430.5,202.041,426.5,198.041" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="424.5" x2="592.5" y1="198.041" y2="198.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="436.5" y="193.2988">R&#233;ponse</text><polygon fill="#222222" points="246.5,223.3516,236.5,227.3516,246.5,231.3516,242.5,227.3516" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="240.5" x2="413.5" y1="227.3516" y2="227.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="252.5" y="222.6094">Observable&lt;Response&gt;</text><polygon fill="#222222" points="62.5,252.6621,52.5,256.6621,62.5,260.6621,58.5,256.6621" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#222222;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="56.5" x2="229.5" y1="256.6621" y2="256.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="68.5" y="251.9199">Observable&lt;Response&gt;</text><!--SRC=[XP7HIWCn44NVynKZFdIBjeAF8eLQ7xfGiAnVaDrStU0ssSrELq7y8B_37tDQ4BEXqBnbPkwvaviBhh433ROCsh7gtwnhTT0xwj7juIhGfrg6uDzNll61Bc-FHsti2pRMuS47Wp3kVIaXiAriAqHwrAoV4GPROLHVCxUhna9Cu_9optNk6A52opwCUzjSgOX7iqM4eJjw1MUJ6oCJawdI5Tj1CsAdQ5gqYPS0xDyj2-YkoU638r2wMwe_YHJGl6gyGpQbAzB6q1fQCZkftkQYEBZEQ-rCWqpBK84kNa92ECpDJheLFz-jTpsKmLYHcgNHFPMzXAhB1lS5-YDZCO8aRu-J55RyA-TX_-9V]--></g></svg></div></section><section class="chapter"><h2 id="exercice-4-1-prot-ger-une-section-profil" data-toc="exercice-4-1-prot-ger-une-section-profil">Exercice 4.1 : Prot&eacute;ger une section &quot;Profil&quot;</h2><p id="csjpv5_80"><span class="control" id="csjpv5_84">Objectif :</span> Cr&eacute;er une page &quot;Profil&quot; accessible uniquement si un utilisateur est &quot;connect&eacute;&quot; (nous allons simuler cet &eacute;tat).</p><p id="csjpv5_81"><span class="control" id="csjpv5_85">Instructions :</span></p><ol class="list _decimal" id="csjpv5_82" type="1"><li class="list__item" id="csjpv5_86"><p id="csjpv5_91"><span class="control" id="csjpv5_93">Cr&eacute;ez un <code class="code" id="csjpv5_94">AuthService</code></span> simple. Il doit avoir :</p><ul class="list _bullet" id="csjpv5_92"><li class="list__item" id="csjpv5_95"><p id="csjpv5_98">Une propri&eacute;t&eacute; priv&eacute;e, par exemple <code class="code" id="csjpv5_99">private _isLoggedIn = false;</code>.</p></li><li class="list__item" id="csjpv5_96"><p id="csjpv5_100">Une m&eacute;thode <code class="code" id="csjpv5_101">isLoggedIn()</code> qui retourne cette valeur.</p></li><li class="list__item" id="csjpv5_97"><p id="csjpv5_102">Des m&eacute;thodes <code class="code" id="csjpv5_103">login()</code> et <code class="code" id="csjpv5_104">logout()</code> qui changent la valeur de cette propri&eacute;t&eacute;.</p></li></ul></li><li class="list__item" id="csjpv5_87"><p id="csjpv5_105"><span class="control" id="csjpv5_106">Cr&eacute;ez un <code class="code" id="csjpv5_111">authGuard</code></span> qui injecte <code class="code" id="csjpv5_107">AuthService</code> et <code class="code" id="csjpv5_108">Router</code>. Si <code class="code" id="csjpv5_109">authService.isLoggedIn()</code> est faux, il doit rediriger vers la page d'accueil (<code class="code" id="csjpv5_110">/</code>).</p></li><li class="list__item" id="csjpv5_88"><p id="csjpv5_112"><span class="control" id="csjpv5_113">Cr&eacute;ez un <code class="code" id="csjpv5_114">ProfileComponent</code></span> simple qui affiche &quot;Bienvenue sur votre profil !&quot;.</p></li><li class="list__item" id="csjpv5_89"><p id="csjpv5_115"><span class="control" id="csjpv5_117">Cr&eacute;ez un <code class="code" id="csjpv5_118">AppComponent</code> (ou autre composant principal)</span> qui contient :</p><ul class="list _bullet" id="csjpv5_116"><li class="list__item" id="csjpv5_119"><p id="csjpv5_121">Deux boutons : &quot;Login&quot; et &quot;Logout&quot;, qui appellent les m&eacute;thodes correspondantes du <code class="code" id="csjpv5_122">AuthService</code>.</p></li><li class="list__item" id="csjpv5_120"><p id="csjpv5_123">Un lien <code class="code" id="csjpv5_124">routerLink</code> vers <code class="code" id="csjpv5_125">/profile</code>.</p></li></ul></li><li class="list__item" id="csjpv5_90"><p id="csjpv5_126"><span class="control" id="csjpv5_127">Configurez vos routes</span> pour que la route <code class="code" id="csjpv5_128">/profile</code> soit prot&eacute;g&eacute;e par votre <code class="code" id="csjpv5_129">authGuard</code>.</p></li></ol><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-4-1" data-toc="correction-exercice-4-1">Correction exercice 4.1</h3></div><div class="collapse__content"><section class="procedure-steps" id="csjpv5_130"><p id="csjpv5_131">Voici l'impl&eacute;mentation compl&egrave;te de ce mini-syst&egrave;me d'authentification.</p><p id="csjpv5_132"><span class="control" id="csjpv5_142">1. <code class="code" id="csjpv5_143">auth.service.ts</code></span></p><div class="code-block" data-lang="ts">
// src/app/auth/auth.service.ts
import {Injectable} from '@angular/core';

@Injectable({
    providedIn: 'root'
})
export class AuthService {
    private _isLoggedIn = false;

    isLoggedIn(): boolean {
        console.log(`Checking auth status: ${this._isLoggedIn}`);
        return this._isLoggedIn;
    }

    login(): void {
        this._isLoggedIn = true;
        console.log('User logged in.');
    }

    logout(): void {
        this._isLoggedIn = false;
        console.log('User logged out.');
    }
}
</div><p id="csjpv5_134"><span class="control" id="csjpv5_144">2. <code class="code" id="csjpv5_145">auth.guard.ts</code></span></p><div class="code-block" data-lang="ts">
// src/app/auth/auth.guard.ts
import {inject} from '@angular/core';
import {Router, CanActivateFn} from '@angular/router';
import {AuthService} from './auth.service';

export const authGuard: CanActivateFn = (route, state) =&gt; {
    const authService = inject(AuthService);
    const router = inject(Router);

    if (authService.isLoggedIn()) {
        return true;
    }

    alert(&quot;Vous n'êtes pas autorisé à voir cette page !&quot;);
    return router.parseUrl('/');
};
</div><p id="csjpv5_136"><span class="control" id="csjpv5_146">3. <code class="code" id="csjpv5_147">profile.component.ts</code></span></p><div class="code-block" data-lang="ts">
// src/app/profile/profile.component.ts
import {Component} from '@angular/core';

@Component({
    selector: 'app-profile',
    standalone: true,
    template: `&lt;h1&gt;Bienvenue sur votre profil !&lt;/h1&gt;`
})
export class ProfileComponent {
}
</div><p id="csjpv5_138"><span class="control" id="csjpv5_148">4. <code class="code" id="csjpv5_149">app.routes.ts</code></span></p><div class="code-block" data-lang="ts">
// src/app/app.routes.ts
import {Routes} from '@angular/router';
import {HomeComponent} from './home/home.component'; // Supposez que ce composant existe
import {ProfileComponent} from './profile/profile.component';
import {authGuard} from './auth/auth.guard';

export const routes: Routes = [
    {path: '', component: HomeComponent},
    {
        path: 'profile',
        component: ProfileComponent,
        canActivate: [authGuard]
    }
];
</div><p id="csjpv5_140"><span class="control" id="csjpv5_150">5. <code class="code" id="csjpv5_151">app.component.ts</code> (Le composant principal avec les boutons)</span></p><div class="code-block" data-lang="ts">
// src/app/app.component.ts
import {Component, inject} from '@angular/core';
import {RouterLink, RouterOutlet} from '@angular/router';
import {AuthService} from './auth/auth.service';

@Component({
    selector: 'app-root',
    standalone: true,
    imports: [RouterOutlet, RouterLink],
    template: `
    &lt;nav&gt;
      &lt;a routerLink=&quot;/&quot;&gt;Accueil&lt;/a&gt; | 
      &lt;a routerLink=&quot;/profile&quot;&gt;Profil&lt;/a&gt;
    &lt;/nav&gt;
    &lt;hr&gt;
    &lt;button (click)=&quot;login()&quot;&gt;Login&lt;/button&gt;
    &lt;button (click)=&quot;logout()&quot;&gt;Logout&lt;/button&gt;
    &lt;hr&gt;
    &lt;router-outlet&gt;&lt;/router-outlet&gt;
  `
})
export class AppComponent {
    private authService = inject(AuthService);

    login() {
        this.authService.login();
    }

    logout() {
        this.authService.logout();
    }
}
</div><ol class="list _decimal"></ol></section></div></div></section></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><ol class="list _decimal" id="csjpv5_152" type="1"><li class="list__item" id="csjpv5_153"><p id="csjpv5_158"><span class="control" id="csjpv5_159">Quel est le r&ocirc;le principal d'un garde <code class="code" id="csjpv5_160">CanActivate</code>?</span> a. Pr&eacute;-charger les donn&eacute;es pour une route. b. Contr&ocirc;ler si un utilisateur peut acc&eacute;der &agrave; une route. c. Intercepter les requ&ecirc;tes HTTP pour y ajouter des headers. d. Emp&ecirc;cher un utilisateur de quitter une route.</p></li><li class="list__item" id="csjpv5_154"><p id="csjpv5_161"><span class="control" id="csjpv5_162">Dans un <code class="code" id="csjpv5_163">HttpInterceptor</code>, pourquoi doit-on utiliser <code class="code" id="csjpv5_164">request.clone()</code> pour ajouter un header ?</span></p></li><li class="list__item" id="csjpv5_155"><p id="csjpv5_165"><span class="control" id="csjpv5_166">Vous voulez afficher une bo&icirc;te de dialogue de confirmation &quot;Voulez-vous vraiment quitter ?&quot; si l'utilisateur a un formulaire non sauvegard&eacute;. Quel type de <code class="code" id="csjpv5_167">Route Guard</code> est le plus appropri&eacute; pour ce cas ?</span></p></li><li class="list__item" id="csjpv5_156"><p id="csjpv5_168"><span class="control" id="csjpv5_169">Comment un <code class="code" id="csjpv5_175">HttpInterceptor</code> est-il &quot;activ&eacute;&quot; ou enregistr&eacute; dans une application Angular moderne (standalone) ?</span> a. En l'ajoutant dans le tableau <code class="code" id="csjpv5_170">providers</code> du <code class="code" id="csjpv5_171">AppComponent</code>. b. En utilisant la fonction <code class="code" id="csjpv5_172">withInterceptors()</code> dans l'appel &agrave; <code class="code" id="csjpv5_173">provideHttpClient()</code>. c. En le d&eacute;clarant dans le fichier <code class="code" id="csjpv5_174">angular.json</code>. d. Il est activ&eacute; automatiquement d&egrave;s que le fichier est cr&eacute;&eacute;.</p></li><li class="list__item" id="csjpv5_157"><p id="csjpv5_176"><span class="control" id="csjpv5_177">Un <code class="code" id="csjpv5_178">Route Guard</code> peut-il rediriger un utilisateur vers une autre page ? Si oui, comment ?</span></p></li></ol></section><section class="chapter"><h2 id="conclusion" data-toc="conclusion">Conclusion</h2><p id="csjpv5_179">Vous avez maintenant ajout&eacute; deux des outils les plus importants de l'arsenal d'un d&eacute;veloppeur Angular avanc&eacute;. Avec les * * <code class="code" id="csjpv5_181">Route Guards</code>**, vous &ecirc;tes le ma&icirc;tre des flux de navigation, capable de prot&eacute;ger des sections enti&egrave;res de votre application. Avec les <span class="control" id="csjpv5_182"><code class="code" id="csjpv5_183">HttpInterceptors</code></span>, vous avez un point de contr&ocirc;le central pour toute votre communication avec le monde ext&eacute;rieur, ce qui rend votre code plus propre, plus s&ucirc;r et plus facile &agrave; maintenir.</p><p id="csjpv5_180">Ces outils g&egrave;rent l'acc&egrave;s et la communication. Mais que se passe-t-il si, avant m&ecirc;me d'accorder l'acc&egrave;s &agrave; une route, nous voulions nous assurer que les donn&eacute;es n&eacute;cessaires &agrave; son affichage sont d&eacute;j&agrave; pr&ecirc;tes et disponibles ? Cela &eacute;viterait les spinners de chargement disgracieux qui apparaissent apr&egrave;s que la page soit affich&eacute;e. C'est le r&ocirc;le des ** <code class="code" id="csjpv5_184">Resolvers</code>**, que nous allons d&eacute;couvrir dans la partie &quot;Pour aller plus loin&quot;, avant de tout synth&eacute;tiser dans un cas pratique d'authentification complet.</p></section><div class="last-modified">10 août 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="003-01-lazy-loading.html" class="navigation-links__prev">Module 3 : Pour aller plus loin - Architecturer pour la Vitesse : Le Lazy Loading des Routes</a><a href="004-01-route-lifecycle.html" class="navigation-links__next">Module 4 : Pour aller plus loin - Le Cycle de Vie d'une Route : Pr&eacute;paration et Synth&egrave;se</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>