<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-10-14T10:01:35.566715"><title>Module 5 : L'essentiel - Garantir la Qualit&eacute; avec les Tests Unitaires | Angular avancé</title><script type="application/json" id="virtual-toc-data">[{"id":"objectifs-p-dagogiques","level":0,"title":"Objectifs pédagogiques","anchor":"#objectifs-p-dagogiques"},{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"l-cosyst-me-de-test-jasmine-karma","level":0,"title":"L\u0027Écosystème de Test : Jasmine \u0026 Karma","anchor":"#l-cosyst-me-de-test-jasmine-karma"},{"id":"tester-les-services","level":0,"title":"Tester les Services","anchor":"#tester-les-services"},{"id":"tester-les-composants-testbed","level":0,"title":"Tester les Composants : TestBed","anchor":"#tester-les-composants-testbed"},{"id":"exercice-5-1-tester-un-service-d-authentification","level":0,"title":"Exercice 5.1 : Tester un service d\u0027authentification","anchor":"#exercice-5-1-tester-un-service-d-authentification"},{"id":"auto-valuation","level":0,"title":"Auto-évaluation","anchor":"#auto-valuation"},{"id":"conclusion","level":0,"title":"Conclusion","anchor":"#conclusion"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 5 : L'essentiel - Garantir la Qualit&eacute; avec les Tests Unitaires | Angular avancé"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Angular avancé Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/005-00-unit-test.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 5 : L'essentiel - Garantir la Qualit&eacute; avec les Tests Unitaires | Angular avancé"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/005-00-unit-test.html#webpage",
    "url": "writerside-documentation/005-00-unit-test.html",
    "name": "Module 5 : L'essentiel - Garantir la Qualit&eacute; avec les Tests Unitaires | Angular avancé",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Angular avancé Help"
}</script><!-- End Schema.org --></head><body data-id="005-00-unit-test" data-main-title="Module 5 : L'essentiel - Garantir la Qualité avec les Tests Unitaires" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Angular avancé  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="005-00-unit-test" id="005-00-unit-test.md">Module 5 : L'essentiel - Garantir la Qualité avec les Tests Unitaires</h1><section class="chapter"><h2 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h2><p id="-5itqdn_11">&Agrave; la fin de ce module, vous serez capable de :</p><ul class="list _bullet" id="-5itqdn_12"><li class="list__item" id="-5itqdn_13"><p id="-5itqdn_18"><span class="control" id="-5itqdn_19">Comprendre</span> le r&ocirc;le et l'importance des tests unitaires dans un projet professionnel.</p></li><li class="list__item" id="-5itqdn_14"><p id="-5itqdn_20"><span class="control" id="-5itqdn_21">Distinguer</span> les outils de l'&eacute;cosyst&egrave;me de test Angular : Jasmine et Karma.</p></li><li class="list__item" id="-5itqdn_15"><p id="-5itqdn_22"><span class="control" id="-5itqdn_23">&Eacute;crire</span> des tests unitaires pour des services, y compris ceux avec des d&eacute;pendances comme <code class="code" id="-5itqdn_24">HttpClient</code>.</p></li><li class="list__item" id="-5itqdn_16"><p id="-5itqdn_25"><span class="control" id="-5itqdn_26">Utiliser</span> le <code class="code" id="-5itqdn_27">TestBed</code> pour cr&eacute;er un environnement de test isol&eacute; pour vos composants.</p></li><li class="list__item" id="-5itqdn_17"><p id="-5itqdn_28"><span class="control" id="-5itqdn_29">Acc&eacute;der</span> &agrave; l'instance d'un composant et &agrave; son DOM pour v&eacute;rifier son comportement et son rendu.</p></li></ul></section><section class="chapter"><h2 id="introduction" data-toc="introduction">Introduction</h2><p id="-5itqdn_30">Vous avez construit une application avec une belle architecture, des flux de donn&eacute;es ma&icirc;tris&eacute;s et des routes s&eacute;curis&eacute;es. C'est comme avoir b&acirc;ti une maison magnifique. Mais comment vous assurer que les fondations sont solides ? Comment savoir si, en repeignant le salon (en ajoutant une nouvelle fonctionnalit&eacute;), vous n'avez pas accidentellement cr&eacute;&eacute; une fissure dans le mur de la cuisine (cass&eacute; une autre fonctionnalit&eacute;) ?</p><p id="-5itqdn_31">La r&eacute;ponse est le <span class="control" id="-5itqdn_33">test</span>. Les tests unitaires sont votre filet de s&eacute;curit&eacute;. Ils vous donnent la confiance n&eacute;cessaire pour refactoriser, faire &eacute;voluer et maintenir votre application sur le long terme sans crainte de r&eacute;gressions.</p><p id="-5itqdn_32">Beaucoup de d&eacute;veloppeurs voient les tests comme une corv&eacute;e. Dans ce module, je veux vous montrer qu'ils sont en r&eacute;alit&eacute; un super-pouvoir. Un super-pouvoir qui vous permet de livrer un code de meilleure qualit&eacute;, de collaborer plus sereinement en &eacute;quipe et, paradoxalement, d'aller plus vite, car vous passerez moins de temps &agrave; d&eacute;boguer des probl&egrave;mes inattendus. Nous allons apprendre &agrave; tester les deux briques fondamentales de notre application : les services et les composants.</p></section><section class="chapter"><h2 id="l-cosyst-me-de-test-jasmine-karma" data-toc="l-cosyst-me-de-test-jasmine-karma">L'&Eacute;cosyst&egrave;me de Test : Jasmine &amp; Karma</h2><p id="-5itqdn_34">Quand vous lancez <code class="code" id="-5itqdn_36">ng test</code>, deux acteurs principaux entrent en sc&egrave;ne :</p><ol class="list _decimal" id="-5itqdn_35" type="1"><li class="list__item" id="-5itqdn_37"><p id="-5itqdn_39"><span class="control" id="-5itqdn_41">Jasmine :</span> C'est le <span class="control" id="-5itqdn_42">framework de test</span>. Il vous fournit la syntaxe et les outils pour &eacute;crire vos tests. Pensez-y comme au langage que vous utilisez pour d&eacute;crire ce que votre code devrait faire. Ses mots-cl&eacute;s principaux sont :</p><ul class="list _bullet" id="-5itqdn_40"><li class="list__item" id="-5itqdn_43"><p id="-5itqdn_47"><code class="code" id="-5itqdn_48">describe('Sujet du test', () =&gt; { ... })</code>: Regroupe un ensemble de tests li&eacute;s (une suite de tests).</p></li><li class="list__item" id="-5itqdn_44"><p id="-5itqdn_49"><code class="code" id="-5itqdn_50">it('devrait faire ceci...', () =&gt; { ... })</code>: Repr&eacute;sente un cas de test individuel.</p></li><li class="list__item" id="-5itqdn_45"><p id="-5itqdn_51"><code class="code" id="-5itqdn_52">expect(valeur_actuelle).toBe(valeur_attendue)</code>: C'est l' <span class="control" id="-5itqdn_53">assertion</span>. C'est l&agrave; que vous v&eacute;rifiez si votre code se comporte comme pr&eacute;vu. <code class="code" id="-5itqdn_54">toBe</code>, <code class="code" id="-5itqdn_55">toEqual</code>, <code class="code" id="-5itqdn_56">toBeTruthy</code> sont des &quot;matchers&quot;.</p></li><li class="list__item" id="-5itqdn_46"><p id="-5itqdn_57"><code class="code" id="-5itqdn_58">beforeEach(() =&gt; { ... })</code>: Une fonction de configuration qui s'ex&eacute;cute avant <span class="emphasis" id="-5itqdn_59">chaque</span> test <code class="code" id="-5itqdn_60">it</code> dans une suite <code class="code" id="-5itqdn_61">describe</code>. Id&eacute;al pour initialiser les objets.</p></li></ul></li><li class="list__item" id="-5itqdn_38"><p id="-5itqdn_62"><span class="control" id="-5itqdn_63">Karma :</span> C'est le <span class="control" id="-5itqdn_64">lanceur de tests (Test Runner)</span>. Son travail est de prendre vos tests &eacute;crits avec Jasmine, de d&eacute;marrer un vrai navigateur (comme Chrome), d'ex&eacute;cuter les tests &agrave; l'int&eacute;rieur de ce navigateur, puis de vous afficher les r&eacute;sultats dans la console.</p></li></ol></section><section class="chapter"><h2 id="tester-les-services" data-toc="tester-les-services">Tester les Services</h2><p id="-5itqdn_65">Les services sont souvent le point de d&eacute;part le plus simple pour les tests, car ils n'ont pas de template ni de cycle de vie de composant complexe.</p><section class="chapter"><h3 id="cas-1-service-simple-sans-d-pendances" data-toc="cas-1-service-simple-sans-d-pendances">Cas 1 : Service simple, sans d&eacute;pendances</h3><p id="-5itqdn_68">C'est le cas le plus facile. On cr&eacute;e une instance du service et on teste ses m&eacute;thodes.</p><div class="code-block" data-lang="ts">
// a-simple.service.ts
@Injectable({providedIn: 'root'})
export class SimpleCalculatorService {
    add(a: number, b: number): number {
        return a + b;
    }
}
</div><div class="code-block" data-lang="ts">
// a-simple.service.spec.ts
import {SimpleCalculatorService} from './a-simple.service';

describe('SimpleCalculatorService', () =&gt; {
    let service: SimpleCalculatorService;

    // Avant chaque test, on crée une nouvelle instance fraîche
    beforeEach(() =&gt; {
        service = new SimpleCalculatorService();
    });

    it('devrait être créé', () =&gt; {
        expect(service).toBeTruthy();
    });

    it('devrait additionner deux nombres correctement', () =&gt; {
        // On appelle la méthode à tester
        const result = service.add(2, 3);
        // On vérifie que le résultat est celui attendu
        expect(result).toBe(5);
    });
});
</div></section><section class="chapter"><h3 id="cas-2-service-avec-des-d-pendances-httpclient" data-toc="cas-2-service-avec-des-d-pendances-httpclient">Cas 2 : Service avec des d&eacute;pendances (<code class="code" id="-5itqdn_77">HttpClient</code>)</h3><p id="-5itqdn_72">Comment tester un service qui fait des appels API sans r&eacute;ellement appeler votre backend ? En utilisant un <span class="control" id="-5itqdn_78">mock</span>. <code class="code" id="-5itqdn_79">HttpClientTestingModule</code> est un module fourni par Angular qui remplace le vrai <code class="code" id="-5itqdn_80">HttpClient</code> par un faux, que nous pouvons contr&ocirc;ler.</p><p id="-5itqdn_73"><code class="code" id="-5itqdn_81">HttpTestingController</code> est l'outil qui nous permet d'interagir avec ce faux <code class="code" id="-5itqdn_82">HttpClient</code>, de simuler des r&eacute;ponses et de v&eacute;rifier que les bonnes requ&ecirc;tes sont faites.</p><div class="code-block" data-lang="ts">
// data.service.ts
@Injectable({providedIn: 'root'})
export class DataService {
    constructor(private http: HttpClient) {
    }

    getUsers() {
        return this.http.get&lt;User[]&gt;('/api/users');
    }
}
</div><div class="code-block" data-lang="ts">
// data.service.spec.ts
import {TestBed} from '@angular/core/testing';
import {HttpClientTestingModule, HttpTestingController}
    from '@angular/common/http/testing';
import {DataService} from './data.service';

describe('DataService', () =&gt; {
    let service: DataService;
    let httpTestingController: HttpTestingController;

    beforeEach(() =&gt; {
        TestBed.configureTestingModule({
            // On importe le module de test HTTP
            imports: [HttpClientTestingModule],
            providers: [DataService]
        });
        // On injecte le service et le contrôleur de test
        service = TestBed.inject(DataService);
        httpTestingController = TestBed.inject(HttpTestingController);
    });

    it('devrait récupérer les utilisateurs via une requête GET', () =&gt; {
        const mockUsers = [{id: 1, name: 'Test User'}];

        service.getUsers().subscribe(users =&gt; {
            // On vérifie que les données reçues sont correctes
            expect(users).toEqual(mockUsers);
        });

        // On s'attend à ce qu'une requête ait été faite vers cette URL
        const req = httpTestingController.expectOne('/api/users');
        // On vérifie que la méthode était bien GET
        expect(req.request.method).toEqual('GET');

        // On simule une réponse du serveur avec nos données mockées
        req.flush(mockUsers);
    });
});
</div><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="374px" preserveAspectRatio="none" style="width:626px;height:374px;background:#FFFFFF;" version="1.1" viewBox="0 0 626 374" width="626px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="29.3105" style="stroke:#696969;stroke-width:1.0;" width="10" x="205.5" y="67.7988"/><rect fill="#FFFFFF" height="152.5527" style="stroke:#696969;stroke-width:1.0;" width="10" x="344" y="126.4199"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="26" x2="26" y1="36.4883" y2="339.2832"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="210" x2="210" y1="36.4883" y2="339.2832"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="349" x2="349" y1="36.4883" y2="339.2832"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="553.5" x2="553.5" y1="36.4883" y2="339.2832"/><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="43" x="5" y="5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="12" y="25.5352">Test</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="43" x="5" y="338.2832"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="12" y="358.8184">Test</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="93" x="164" y="5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="171" y="25.5352">DataService</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="93" x="164" y="338.2832"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="171" y="358.8184">DataService</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="164" x="267" y="5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="274" y="25.5352">HttpTestingController</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="164" x="267" y="338.2832"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="274" y="358.8184">HttpTestingController</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="133" x="487.5" y="5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="494.5" y="25.5352">HttpClient (Mock)</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="133" x="487.5" y="338.2832"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="494.5" y="358.8184">HttpClient (Mock)</text><rect fill="#FFFFFF" height="29.3105" style="stroke:#696969;stroke-width:1.0;" width="10" x="205.5" y="67.7988"/><rect fill="#FFFFFF" height="152.5527" style="stroke:#696969;stroke-width:1.0;" width="10" x="344" y="126.4199"/><polygon fill="#454645" points="193.5,63.7988,203.5,67.7988,193.5,71.7988,197.5,67.7988" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="26.5" x2="199.5" y1="67.7988" y2="67.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="33.5" y="63.0566">getUsers()</text><polygon fill="#454645" points="542,93.1094,552,97.1094,542,101.1094,546,97.1094" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="210.5" x2="548" y1="97.1094" y2="97.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="217.5" y="92.3672">get('/api/users')</text><polygon fill="#454645" points="332,122.4199,342,126.4199,332,130.4199,336,126.4199" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="26.5" x2="338" y1="126.4199" y2="126.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="33.5" y="121.6777">expectOne('/api/users')</text><polygon fill="#454645" points="542,151.7305,552,155.7305,542,159.7305,546,155.7305" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="354" x2="548" y1="155.7305" y2="155.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="361" y="150.9883">Trouve la requ&#234;te en attente</text><path d="M359,172.2305 L359,190.2305 A3.5,3.5 0 0 0 362.5,193.7305 L515.5,193.7305 A3.5,3.5 0 0 0 519,190.2305 L519,178.7305 L509,168.7305 L362.5,168.7305 A3.5,3.5 0 0 0 359,172.2305 " fill="#7FFFD4" style="stroke:#454645;stroke-width:1.5;"/><path d="M509,168.7305 L509,176.9805 A1.75,1.75 0 0 0 510.75,178.7305 L519,178.7305 L509,168.7305 " fill="#7FFFD4" style="stroke:#454645;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="365" y="186.2988">La requ&#234;te est trouv&#233;e</text><polygon fill="#454645" points="332,216.3516,342,220.3516,332,224.3516,336,220.3516" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="26.5" x2="338" y1="220.3516" y2="220.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="33.5" y="215.6094">req.flush(mockData)</text><polygon fill="#454645" points="542,245.6621,552,249.6621,542,253.6621,546,249.6621" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="354" x2="548" y1="249.6621" y2="249.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="361" y="244.9199">Simule la r&#233;ponse</text><polygon fill="#454645" points="221.5,274.9727,211.5,278.9727,221.5,282.9727,217.5,278.9727" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="215.5" x2="553" y1="278.9727" y2="278.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="227.5" y="274.2305">notifie la r&#233;ponse (subscribe)</text><line style="stroke:#454645;stroke-width:1.0;" x1="26.5" x2="68.5" y1="308.2832" y2="308.2832"/><line style="stroke:#454645;stroke-width:1.0;" x1="68.5" x2="68.5" y1="308.2832" y2="321.2832"/><line style="stroke:#454645;stroke-width:1.0;" x1="27.5" x2="68.5" y1="321.2832" y2="321.2832"/><polygon fill="#454645" points="37.5,317.2832,27.5,321.2832,37.5,325.2832,33.5,321.2832" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="33.5" y="303.541">Assertions sur les donn&#233;es</text><!--SRC=[TP11Si8m34NtFeNAXcJHicVHcGvTTD5E5z03c2281iTsRJdJ7ebUWujLBeCd0RgA8xt_zQKxRh53w6aTj6KLzsIz3he3GnRvsoEumArJIgfC3NcXOBB2o9DnwLcpNcBegS6BpWkppmAokuMp79mn62QW8xovPh_WOAxvXI6KTvM9kh2verJsWlj764o4EUoGFoA6MDLADqozPXmIQaYB-6ntKbRJcVOqIzbWMgiDthGeay-vHOnV7Xj-jtXXKGpAZaKqdhuABlK8HaF0ptJy4GbQqCooFohhv3_GhcLms-8rXzSXBg4uknmFjpCA-R0rARPL9yMyKVrVcYLroPpI70_UsOYgTAzEBk5eIoCQgfZMiGcqnj4PonLAlh_l79wY78n9j11J08CHDivQMIN-0W00]--></g></svg></div></section></section><section class="chapter"><h2 id="tester-les-composants-testbed" data-toc="tester-les-composants-testbed">Tester les Composants : <code class="code" id="-5itqdn_90">TestBed</code></h2><p id="-5itqdn_84">Pour tester un composant, nous avons besoin de plus qu'un simple <code class="code" id="-5itqdn_91">new MyComponent()</code>. Nous avons besoin d'un mini-environnement Angular pour g&eacute;rer le template, l'injection de d&eacute;pendances et la d&eacute;tection de changement. C'est le r&ocirc;le de <code class="code" id="-5itqdn_92">TestBed</code>.</p><p id="-5itqdn_85"><code class="code" id="-5itqdn_93">TestBed.configureTestingModule({...})</code> vous permet de cr&eacute;er un module de test &quot;&agrave; la vol&eacute;e&quot;. <code class="code" id="-5itqdn_94">TestBed.createComponent(MyComponent)</code> cr&eacute;e une instance du composant et retourne un <code class="code" id="-5itqdn_95">ComponentFixture</code>.</p><p id="-5itqdn_86">Le <code class="code" id="-5itqdn_96">fixture</code> est un objet qui nous donne acc&egrave;s &agrave; tout ce dont nous avons besoin :</p><ul class="list _bullet" id="-5itqdn_87"><li class="list__item" id="-5itqdn_97"><p id="-5itqdn_100"><code class="code" id="-5itqdn_101">fixture.componentInstance</code>: L'instance de la classe TypeScript de notre composant.</p></li><li class="list__item" id="-5itqdn_98"><p id="-5itqdn_102"><code class="code" id="-5itqdn_103">fixture.nativeElement</code>: L'&eacute;l&eacute;ment DOM racine de notre composant.</p></li><li class="list__item" id="-5itqdn_99"><p id="-5itqdn_104"><code class="code" id="-5itqdn_105">fixture.detectChanges()</code>: D&eacute;clenche un cycle de d&eacute;tection de changement (essentiel pour mettre &agrave; jour la vue apr&egrave;s avoir chang&eacute; une propri&eacute;t&eacute;).</p></li></ul><div class="code-block" data-lang="ts">
// simple-hello.component.ts
@Component({
    selector: 'app-simple-hello',
    template: `&lt;h1&gt;Hello, {{ name }}!&lt;/h1&gt;`
})
export class SimpleHelloComponent {
    name = 'World';
}
</div><div class="code-block" data-lang="ts">
// simple-hello.component.spec.ts
import {ComponentFixture, TestBed} from '@angular/core/testing';
import {SimpleHelloComponent} from './simple-hello.component';

describe('SimpleHelloComponent', () =&gt; {
    let component: SimpleHelloComponent;
    let fixture: ComponentFixture&lt;SimpleHelloComponent&gt;;

    beforeEach(async () =&gt; {
        // Configure le &quot;module&quot; de test
        await TestBed.configureTestingModule({
            imports: [SimpleHelloComponent] // Pour les composants Standalone
        }).compileComponents();

        // Crée le composant
        fixture = TestBed.createComponent(SimpleHelloComponent);
        component = fixture.componentInstance;
        // Déclenche le premier rendu
        fixture.detectChanges();
    });

    it('devrait afficher &quot;Hello, World!&quot; par défaut', () =&gt; {
        const h1 = fixture.nativeElement.querySelector('h1');
        expect(h1.textContent).toContain('Hello, World!');
    });

    it('devrait mettre à jour le h1 quand le nom change', () =&gt; {
        // On modifie la propriété dans la classe
        component.name = 'Angular';
        // On dit à Angular de mettre à jour la vue
        fixture.detectChanges();

        const h1 = fixture.nativeElement.querySelector('h1');
        expect(h1.textContent).toContain('Hello, Angular!');
    });
});
</div></section><section class="chapter"><h2 id="exercice-5-1-tester-un-service-d-authentification" data-toc="exercice-5-1-tester-un-service-d-authentification">Exercice 5.1 : Tester un service d'authentification</h2><p id="-5itqdn_106"><span class="control" id="-5itqdn_112">Objectif :</span> &Eacute;crire les tests unitaires pour le <code class="code" id="-5itqdn_113">AuthService</code> que nous avons vu dans le module pr&eacute;c&eacute;dent (la version qui utilise <code class="code" id="-5itqdn_114">localStorage</code>).</p><p id="-5itqdn_107"><span class="control" id="-5itqdn_115">Rappel du service :</span></p><div class="code-block" data-lang="ts">

@Injectable({providedIn: 'root'})
export class AuthService {
    private readonly JWT_KEY = 'my_app_jwt';

    getToken(): string | null {
        return localStorage.getItem(this.JWT_KEY);
    }

    isLoggedIn(): boolean {
        return !!this.getToken();
    }

    login(): void {
        localStorage.setItem(this.JWT_KEY, 'fake-token');
    }

    logout(): void {
        localStorage.removeItem(this.JWT_KEY);
    }
}
</div><p id="-5itqdn_109"><span class="control" id="-5itqdn_116">Instructions :</span></p><ol class="list _decimal" id="-5itqdn_110" type="1"><li class="list__item" id="-5itqdn_117"><p id="-5itqdn_122">Cr&eacute;ez le fichier de test <code class="code" id="-5itqdn_123">auth.service.spec.ts</code>.</p></li><li class="list__item" id="-5itqdn_118"><p id="-5itqdn_124">Dans le <code class="code" id="-5itqdn_125">beforeEach</code>, assurez-vous de bien nettoyer le <code class="code" id="-5itqdn_126">localStorage</code> pour que les tests soient ind&eacute;pendants les uns des autres.</p></li><li class="list__item" id="-5itqdn_119"><p id="-5itqdn_127">&Eacute;crivez un test pour <code class="code" id="-5itqdn_128">isLoggedIn()</code> qui v&eacute;rifie qu'il retourne <code class="code" id="-5itqdn_129">false</code> par d&eacute;faut.</p></li><li class="list__item" id="-5itqdn_120"><p id="-5itqdn_130">&Eacute;crivez un test pour la m&eacute;thode <code class="code" id="-5itqdn_131">login()</code>. Apr&egrave;s l'avoir appel&eacute;e, v&eacute;rifiez que <code class="code" id="-5itqdn_132">isLoggedIn()</code> retourne <code class="code" id="-5itqdn_133">true</code>.</p></li><li class="list__item" id="-5itqdn_121"><p id="-5itqdn_134">&Eacute;crivez un test pour la m&eacute;thode <code class="code" id="-5itqdn_135">logout()</code>. Apr&egrave;s <code class="code" id="-5itqdn_136">login()</code> puis <code class="code" id="-5itqdn_137">logout()</code>, v&eacute;rifiez que <code class="code" id="-5itqdn_138">isLoggedIn()</code> retourne bien <code class="code" id="-5itqdn_139">false</code>.</p></li></ol><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-5-1" data-toc="correction-exercice-5-1">Correction exercice 5.1</h3></div><div class="collapse__content"><section class="procedure-steps" id="-5itqdn_140"><p id="-5itqdn_141">Voici une solution possible. La cl&eacute; ici est de bien isoler chaque test en utilisant `beforeEach` et `afterEach` pour g&eacute;rer l'&eacute;tat global du `localStorage`.</p><div class="code-block" data-lang="ts">
// src/app/auth/auth.service.spec.ts
import {TestBed} from '@angular/core/testing';
import {AuthService} from './auth.service';

describe('AuthService', () =&gt; {
    let service: AuthService;

    beforeEach(() =&gt; {
        TestBed.configureTestingModule({
            providers: [AuthService]
        });
        service = TestBed.inject(AuthService);

        // On nettoie le localStorage avant chaque test pour l'isolation
        localStorage.removeItem('my_app_jwt');
    });

    it('devrait être créé', () =&gt; {
        expect(service).toBeTruthy();
    });

    it('#isLoggedIn devrait retourner false quand aucun token n-est présent', () =&gt; {
        expect(service.isLoggedIn()).toBeFalse();
    });

    it('#login devrait stocker un token et #isLoggedIn devrait retourner true', () =&gt; {
        // Appel de la méthode à tester
        service.login();

        // Assertion
        expect(service.isLoggedIn()).toBeTrue();
        // On peut même vérifier directement le localStorage
        expect(localStorage.getItem('my_app_jwt')).toBe('fake-token');
    });

    it('#logout devrait supprimer le token et #isLoggedIn retourner false', () =&gt; {
        // D'abord, on se connecte pour avoir un état de départ
        service.login();
        expect(service.isLoggedIn()).toBeTrue();

        // Ensuite, on appelle la méthode à tester
        service.logout();

        // Assertion
        expect(service.isLoggedIn()).toBeFalse();
        expect(localStorage.getItem('my_app_jwt')).toBeNull();
    });
});

</div><ol class="list _decimal"></ol></section></div></div></section></section><section class="chapter"><h2 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h2><ol class="list _decimal" id="-5itqdn_143" type="1"><li class="list__item" id="-5itqdn_144"><p id="-5itqdn_149"><span class="control" id="-5itqdn_150">Quel est le r&ocirc;le de <code class="code" id="-5itqdn_154">Karma</code> dans l'&eacute;cosyst&egrave;me de test Angular ?</span> a. Il fournit la syntaxe <code class="code" id="-5itqdn_151">describe</code> et <code class="code" id="-5itqdn_152">it</code>. b. Il ex&eacute;cute les tests dans un vrai navigateur et affiche les r&eacute;sultats. c. Il permet de mocker les appels <code class="code" id="-5itqdn_153">HttpClient</code>. d. Il analyse la couverture de code des tests.</p></li><li class="list__item" id="-5itqdn_145"><p id="-5itqdn_155"><span class="control" id="-5itqdn_156">Expliquez en une phrase l'utilit&eacute; du <code class="code" id="-5itqdn_157">HttpTestingController</code>.</span></p></li><li class="list__item" id="-5itqdn_146"><p id="-5itqdn_158"><span class="control" id="-5itqdn_159">Dans un test de composant, &agrave; quoi sert <code class="code" id="-5itqdn_160">fixture.detectChanges()</code>?</span></p></li><li class="list__item" id="-5itqdn_147"><p id="-5itqdn_161"><span class="control" id="-5itqdn_162">Quelle est la diff&eacute;rence fondamentale entre <code class="code" id="-5itqdn_169">fixture.componentInstance</code> et <code class="code" id="-5itqdn_170">fixture.nativeElement</code>?</span> a. Il n'y en a aucune, ce sont des alias. b. <code class="code" id="-5itqdn_163">componentInstance</code> est la classe TypeScript, <code class="code" id="-5itqdn_164">nativeElement</code> est l'&eacute;l&eacute;ment HTML rendu. c. <code class="code" id="-5itqdn_165">componentInstance</code> est utilis&eacute; pour les tests de services, <code class="code" id="-5itqdn_166">nativeElement</code> pour les composants. d. <code class="code" id="-5itqdn_167">componentInstance</code> est l'objet, <code class="code" id="-5itqdn_168">nativeElement</code> est une cha&icirc;ne de caract&egrave;res repr&eacute;sentant le DOM.</p></li><li class="list__item" id="-5itqdn_148"><p id="-5itqdn_171"><span class="control" id="-5itqdn_172">Pourquoi est-il important d'isoler les tests les uns des autres (par exemple, en nettoyant le <code class="code" id="-5itqdn_173">localStorage</code> dans un <code class="code" id="-5itqdn_174">beforeEach</code>) ?</span></p></li></ol></section><section class="chapter"><h2 id="conclusion" data-toc="conclusion">Conclusion</h2><p id="-5itqdn_175">Vous avez fait vos premiers pas, et les plus importants, dans le monde du test unitaire avec Angular. Vous savez d&eacute;sormais comment isoler et v&eacute;rifier le comportement de vos services et de vos composants. Vous avez appris &agrave; mocker des d&eacute;pendances externes comme <code class="code" id="-5itqdn_177">HttpClient</code> et &agrave; interagir avec vos composants via <code class="code" id="-5itqdn_178">TestBed</code>.</p><p id="-5itqdn_176">C'est une base solide, mais que se passe-t-il lorsque nos composants ont des d&eacute;pendances vers nos propres services ? Comment simuler des actions utilisateur comme des clics ? Et comment tester du code asynchrone, comme des <code class="code" id="-5itqdn_179">Observables</code> RxJS ? C'est ce que nous allons explorer dans la partie &quot;Pour aller plus loin&quot;, o&ugrave; nous aborderons les techniques de mocking avanc&eacute;es et les tests asynchrones.</p></section><div class="last-modified">10 août 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="004-01-route-lifecycle.html" class="navigation-links__prev">Module 4 : Pour aller plus loin - Le Cycle de Vie d'une Route : Pr&eacute;paration et Synth&egrave;se</a><a href="005-01-advanced-unit-test.html" class="navigation-links__next">Module 5 : Pour aller plus loin - Mocking, Spies et Tests Asynchrones</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>